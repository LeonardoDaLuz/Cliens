{"ast":null,"code":"var _jsxFileName = \"/home/leo/Dev/Desafio_frontend_troupe_tecnologia/front/src/components/EditarCliente/index.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from \"react\";\nimport { EditarStyles, CenterButtons, CenteredLoaderWheel } from \"./style\";\nimport { Button, Container, Icon } from \"../../globalStyle\";\nimport assets from \"../../assets\";\nimport Input, { formatCEP, formatCPF } from \"./Input\";\nimport { useFormik } from \"formik\";\nimport { useAppDispatch, useAppSelector } from \"../../store/hooks\";\nimport { useHistory, useLocation, useParams } from \"react-router\";\nimport { loadCustomer, updateCustomer } from \"../../store/customer\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function EditarCliente() {\n  _s();\n\n  const dispatch = useAppDispatch();\n  const history = useHistory();\n  const location = useLocation();\n  const {\n    id\n  } = useParams();\n  useEffect(() => {\n    if (id) dispatch(loadCustomer(id));else formik.setValues({});\n  }, []);\n  const customerState = useAppSelector(store => store.customer);\n  const customer = customerState.customer;\n\n  const validate = values => {\n    const errors = {}; //console.log('isValidCPF', values.cpf, isValidCPF(values.cpf));\n\n    if (!values.name) errors.name = 'Requerido';else if (!isValidName(values.name)) errors.name = 'Deve conter nome completo';else if (values.name.length < 7) errors.name = 'Deve conter pelo menos 7 caracteres';\n    if (!values.cpf) errors.cpf = 'Requerido';else if (values.cpf.length != 14) {\n      errors.cpf = 'Deve conter 11 numeros';\n    } else if (!isValidCPF(values.cpf)) {\n      errors.cpf = 'CPF inválido';\n    }\n    if (!values.email) errors.email = 'Requerido';else if (!isValidEmail(values.email)) errors.email = 'Email inválido';\n    if (!values.cep) errors.cep = 'Requerido';else if (!IsValidCEP(values.cep)) errors.cep = 'Cep invalido';\n    if (!values.street) errors.street = 'Requerido';\n    if (!values.district) errors.district = 'Requerido';\n    if (!values.city) errors.city = 'Requerido';\n    if (!values.number) errors.number = 'Requerido';\n    return errors;\n  };\n\n  const formik = useFormik({\n    initialValues: {},\n    validate,\n    onSubmit: async values => {\n      if (id) {\n        await dispatch(updateCustomer(customer.id, values));\n      } else {\n        await dispatch(updateCustomer(-1, values));\n      }\n\n      history.push('/' + location.search); // dispatch(loginThunk(values.login, values.password));\n    }\n  });\n  useEffect(() => {\n    if (customer && id) {\n      formik.setValues({\n        name: customer.nome,\n        cpf: formatCPF(customer.cpf),\n        email: customer.email,\n        cep: formatCEP(customer.endereco.cep.toString()),\n        street: customer.endereco.rua,\n        district: customer.endereco.bairro,\n        city: customer.endereco.cidade,\n        number: customer.endereco.numero\n      });\n    }\n  }, [customer]);\n\n  async function autoFillWithViaCEP(e) {\n    if (IsValidCEP(e.target.value)) {\n      const url = 'https://viacep.com.br/ws/' + e.target.value + '/json/unicode/';\n      const response = await fetch(url);\n\n      if (response.status === 200) {\n        const responseText = await response.text();\n\n        try {\n          const data = JSON.parse(responseText);\n\n          if (data.logradouro) {\n            console.log(\"deu certo\", data);\n            formik.setFieldValue('street', data.logradouro);\n            formik.setFieldValue('district', data.bairro);\n            formik.setFieldValue('city', data.localidade);\n          } else {\n            console.error('Resposta inesperada para ' + url, responseText);\n          }\n        } catch (err) {\n          console.error('JSON: Não foi possível parsear a resposta da rota ' + url);\n        }\n      } else {\n        console.error('Bad request para ' + url);\n      }\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(EditarStyles, {\n    children: /*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          src: assets.edit_icon,\n          width: \"50px\",\n          height: \"50px\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 21\n        }, this), id && /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Editar Cliente\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 28\n        }, this) || /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Adicionar Cliente\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 59\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 17\n      }, this), (customer || !id) && customerState.status !== 'updating' && /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: formik.handleSubmit,\n        children: [/*#__PURE__*/_jsxDEV(Input, {\n          formik: formik,\n          name: \"name\",\n          type: \"text\",\n          placeholder: \"Nome...\",\n          label: \"Nome\",\n          icon: assets.name_icon\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          formik: formik,\n          type: \"text\",\n          name: \"cpf\",\n          placeholder: \"000.000.000-00\",\n          label: \"CPF\",\n          icon: assets.cpf_icon,\n          format: \"cpf\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          formik: formik,\n          type: \"text\",\n          name: \"email\",\n          placeholder: \"example@gmail.com\",\n          label: \"E-mail\",\n          icon: assets.email_icon\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"fieldset\", {\n          children: [/*#__PURE__*/_jsxDEV(\"legend\", {\n            children: \"Endere\\xE7o:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            formik: formik,\n            type: \"text\",\n            name: \"cep\",\n            placeholder: \"83209-000\",\n            label: \"CEP\",\n            icon: assets.cep_icon,\n            format: \"cep\",\n            onChange: autoFillWithViaCEP\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            formik: formik,\n            type: \"text\",\n            name: \"street\",\n            placeholder: \"Rua Exemplo da Silva\",\n            label: \"Rua\",\n            icon: assets.street_icon\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 206,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            formik: formik,\n            type: \"text\",\n            name: \"district\",\n            placeholder: \"Bairro\",\n            label: \"Bairro\",\n            icon: assets.bairro_icon\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            formik: formik,\n            type: \"text\",\n            name: \"city\",\n            placeholder: \"S\\xE3o paulo...\",\n            label: \"Cidade\",\n            icon: assets.city_icon\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            formik: formik,\n            type: \"number\",\n            name: \"number\",\n            placeholder: \"123...\",\n            label: \"N\\xFAmero\",\n            icon: assets.number_icon\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(CenterButtons, {\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            type: \"submit\",\n            disabled: !formik.isValid,\n            children: [/*#__PURE__*/_jsxDEV(Icon, {\n              src: assets.login_icon,\n              width: \"32px\",\n              height: \"32px\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 214,\n              columnNumber: 33\n            }, this), \"Salvar\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            children: [/*#__PURE__*/_jsxDEV(Icon, {\n              src: assets.login_icon,\n              width: \"32px\",\n              height: \"32px\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 218,\n              columnNumber: 33\n            }, this), \"Voltar\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 21\n      }, this) || /*#__PURE__*/_jsxDEV(CenteredLoaderWheel, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 189,\n    columnNumber: 9\n  }, this);\n}\n\n_s(EditarCliente, \"1Y/HCliHB45tHM3N7paLKsWWUCY=\", false, function () {\n  return [useAppDispatch, useHistory, useLocation, useParams, useAppSelector, useFormik];\n});\n\n_c = EditarCliente;\n\nfunction isValidCPF(strCPF) {\n  if (!strCPF) return false;\n  strCPF = strCPF.replace(/[^\\d]/g, \"\"); //remove caracteres repetidos\n\n  let Soma;\n  let Resto;\n  Soma = 0;\n  if (strCPF == \"00000000000\") return false;\n\n  for (let i = 1; i <= 9; i++) Soma = Soma + parseInt(strCPF.substring(i - 1, i)) * (11 - i);\n\n  Resto = Soma * 10 % 11;\n  if (Resto == 10 || Resto == 11) Resto = 0;\n  if (Resto != parseInt(strCPF.substring(9, 10))) return false;\n  Soma = 0;\n\n  for (let i = 1; i <= 10; i++) Soma = Soma + parseInt(strCPF.substring(i - 1, i)) * (12 - i);\n\n  Resto = Soma * 10 % 11;\n  if (Resto == 10 || Resto == 11) Resto = 0;\n  if (Resto != parseInt(strCPF.substring(10, 11))) return false;\n  return true;\n}\n\nfunction isValidEmail(email) {\n  return /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i.test(email);\n}\n\nfunction IsValidCEP(strCEP) {\n  const objER = /^\\d{5}-\\d{3}$/;\n\n  if (strCEP.length > 0) {\n    if (objER.test(strCEP.replace(/(\\d{5})(\\d{3})/, \"$1-$2\"))) return true;else return false;\n  } else return false;\n}\n\n_c2 = IsValidCEP;\n\nfunction isValidName(name) {\n  const pattern = /[A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ]{2,99}\\s[A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ]{2,99}/gi;\n  return pattern.test(name);\n}\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"EditarCliente\");\n$RefreshReg$(_c2, \"IsValidCEP\");","map":{"version":3,"sources":["/home/leo/Dev/Desafio_frontend_troupe_tecnologia/front/src/components/EditarCliente/index.tsx"],"names":["React","useEffect","EditarStyles","CenterButtons","CenteredLoaderWheel","Button","Container","Icon","assets","Input","formatCEP","formatCPF","useFormik","useAppDispatch","useAppSelector","useHistory","useLocation","useParams","loadCustomer","updateCustomer","EditarCliente","dispatch","history","location","id","formik","setValues","customerState","store","customer","validate","values","errors","name","isValidName","length","cpf","isValidCPF","email","isValidEmail","cep","IsValidCEP","street","district","city","number","initialValues","onSubmit","push","search","nome","endereco","toString","rua","bairro","cidade","numero","autoFillWithViaCEP","e","target","value","url","response","fetch","status","responseText","text","data","JSON","parse","logradouro","console","log","setFieldValue","localidade","error","err","edit_icon","handleSubmit","name_icon","cpf_icon","email_icon","cep_icon","street_icon","bairro_icon","city_icon","number_icon","isValid","login_icon","strCPF","replace","Soma","Resto","i","parseInt","substring","test","strCEP","objER","pattern"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\nimport { EditarStyles, CenterButtons, CenteredLoaderWheel } from \"./style\";\nimport { Button, Container, Icon, LoaderWheel } from \"../../globalStyle\";\nimport assets from \"../../assets\";\nimport Input, { formatCEP, formatCPF } from \"./Input\";\nimport { useFormik } from \"formik\";\nimport { useAppDispatch, useAppSelector } from \"../../store/hooks\";\nimport { useHistory, useLocation, useParams } from \"react-router\";\nimport { loadCustomer, updateCustomer } from \"../../store/customer\";\nimport { RootState } from \"../../store\";\n\nexport interface FormularyType {\n    name?: string,\n    cpf?: string,\n    email?: string,\n    cep?: string,\n    street?: string,\n    district?: string,\n    city?: string,\n    number?: number\n}\n\ninterface ViaCEPResponseType {\n\n    cep: string,\n    logradouro: string,\n    complemento: string,\n    bairro: string,\n    localidade: string,\n    uf: string,\n    ibge: number,\n    gia: number,\n    ddd: number,\n    siafi: number\n\n}\ntype allPropsAsString<T> = {\n    [P in keyof T as string]: string\n}\n\ntype PropType<TObj, TProp extends keyof TObj> = TObj[TProp];\n\ntype allKeysAsString<T> = {\n    [P in keyof T as string]: PropType<T, P>\n}\n\nexport default function EditarCliente() {\n\n    const dispatch = useAppDispatch();\n\n    const history = useHistory();\n\n    const location = useLocation();\n\n    const { id } = useParams<{ id: string }>();\n\n    useEffect(() => {\n\n        if (id)\n            dispatch(loadCustomer(id));\n        else\n            formik.setValues({});\n\n    }, []);\n\n\n    const customerState = useAppSelector((store: RootState) => store.customer);\n\n    const customer = customerState.customer;\n\n    const validate = (values: FormularyType) => {\n\n        const errors: allPropsAsString<FormularyType> = {};\n\n        //console.log('isValidCPF', values.cpf, isValidCPF(values.cpf));\n\n        if (!values.name)\n            errors.name = 'Requerido';\n        else if (!isValidName(values.name))\n            errors.name = 'Deve conter nome completo';\n        else if (values.name.length < 7)\n            errors.name = 'Deve conter pelo menos 7 caracteres';\n\n\n        if (!values.cpf)\n            errors.cpf = 'Requerido';\n        else if (values.cpf.length != 14) {\n            errors.cpf = 'Deve conter 11 numeros';\n        }\n        else if (!isValidCPF(values.cpf)) {\n\n            errors.cpf = 'CPF inválido';\n        }\n\n        if (!values.email)\n            errors.email = 'Requerido';\n        else if (!isValidEmail(values.email))\n            errors.email = 'Email inválido';\n\n        if (!values.cep)\n            errors.cep = 'Requerido';\n        else if (!IsValidCEP(values.cep))\n            errors.cep = 'Cep invalido';\n\n        if (!values.street)\n            errors.street = 'Requerido';\n\n        if (!values.district)\n            errors.district = 'Requerido';\n\n        if (!values.city)\n            errors.city = 'Requerido';\n\n        if (!values.number)\n            errors.number = 'Requerido';\n\n        return errors;\n    }\n\n    const formik = useFormik({\n        initialValues: {\n\n        },\n        validate,\n        onSubmit: async (values) => {\n\n            if (id) {\n                await dispatch(updateCustomer(customer.id, values));\n            } else {\n                await dispatch(updateCustomer(-1, values));\n            }\n\n            history.push('/'+location.search);\n            // dispatch(loginThunk(values.login, values.password));\n        }\n    })\n\n    useEffect(() => {\n\n        if (customer && id) {\n            formik.setValues({\n                name: customer.nome,\n                cpf: formatCPF(customer.cpf),\n                email: customer.email,\n                cep: formatCEP(customer.endereco.cep.toString()),\n                street: customer.endereco.rua,\n                district: customer.endereco.bairro,\n                city: customer.endereco.cidade,\n                number: customer.endereco.numero\n            });\n        }\n    }, [customer])\n\n\n\n    async function autoFillWithViaCEP(e: React.ChangeEvent<HTMLInputElement>) {\n\n        if (IsValidCEP(e.target.value)) {\n            const url = 'https://viacep.com.br/ws/' + e.target.value + '/json/unicode/';\n            const response = await fetch(url);\n            if (response.status === 200) {\n                const responseText = await response.text();\n\n                try {\n                    const data = JSON.parse(responseText) as ViaCEPResponseType;\n\n                    if (data.logradouro) {\n\n                        console.log(\"deu certo\", data);\n\n                        formik.setFieldValue('street', data.logradouro);\n                        formik.setFieldValue('district', data.bairro);\n                        formik.setFieldValue('city', data.localidade);\n\n                    } else {\n                        console.error('Resposta inesperada para ' + url, responseText);\n                    }\n\n                } catch (err) {\n                    console.error('JSON: Não foi possível parsear a resposta da rota ' + url)\n                }\n            } else {\n                console.error('Bad request para ' + url)\n            }\n        }\n    }\n\n    return (\n        <EditarStyles>\n            <Container>\n\n                <h1>\n                    <Icon src={assets.edit_icon} width='50px' height='50px' />\n                    {id && <span>Editar Cliente</span> || <span>Adicionar Cliente</span>\n                    }\n                </h1>\n\n                {(customer || !id) && customerState.status !== 'updating' &&\n                    <form onSubmit={formik.handleSubmit}>\n                        <Input formik={formik} name='name' type='text' placeholder='Nome...' label='Nome' icon={assets.name_icon} />\n                        <Input formik={formik} type='text' name='cpf' placeholder='000.000.000-00' label='CPF' icon={assets.cpf_icon} format='cpf' />\n                        <Input formik={formik} type='text' name='email' placeholder='example@gmail.com' label='E-mail' icon={assets.email_icon} />\n                        <fieldset>\n                            <legend>Endereço:</legend>\n                            <Input formik={formik} type='text' name='cep' placeholder='83209-000' label='CEP' icon={assets.cep_icon} format='cep' onChange={autoFillWithViaCEP} />\n                            <Input formik={formik} type='text' name='street' placeholder='Rua Exemplo da Silva' label='Rua' icon={assets.street_icon} />\n                            <Input formik={formik} type='text' name='district' placeholder='Bairro' label='Bairro' icon={assets.bairro_icon} />\n                            <Input formik={formik} type='text' name='city' placeholder='São paulo...' label='Cidade' icon={assets.city_icon} />\n                            <Input formik={formik} type='number' name='number' placeholder='123...' label='Número' icon={assets.number_icon} />\n                        </fieldset>\n\n                        <CenterButtons>\n                            <Button type='submit' disabled={!formik.isValid}>\n                                <Icon src={assets.login_icon} width='32px' height='32px' />\n                                Salvar\n                            </Button>\n                            <Button>\n                                <Icon src={assets.login_icon} width='32px' height='32px' />\n                                Voltar\n                            </Button>\n                        </CenterButtons>\n\n                    </form> ||\n                    <CenteredLoaderWheel />\n                }\n\n            </Container>\n        </EditarStyles>\n\n    );\n}\n\nfunction isValidCPF(strCPF: string) {\n\n    if (!strCPF)\n        return false;\n    \n    strCPF = strCPF.replace(/[^\\d]/g, \"\"); //remove caracteres repetidos\n\n    let Soma;\n    let Resto;\n    Soma = 0;\n    if (strCPF == \"00000000000\") return false;\n\n    for (let i = 1; i <= 9; i++) Soma = Soma + parseInt(strCPF.substring(i - 1, i)) * (11 - i);\n    Resto = (Soma * 10) % 11;\n\n    if ((Resto == 10) || (Resto == 11)) Resto = 0;\n    if (Resto != parseInt(strCPF.substring(9, 10))) return false;\n\n    Soma = 0;\n    for (let i = 1; i <= 10; i++) Soma = Soma + parseInt(strCPF.substring(i - 1, i)) * (12 - i);\n    Resto = (Soma * 10) % 11;\n\n    if ((Resto == 10) || (Resto == 11)) Resto = 0;\n    if (Resto != parseInt(strCPF.substring(10, 11))) return false;\n    return true;\n}\n\nfunction isValidEmail(email: string) {\n    return /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i.test(email)\n}\n\n\nfunction IsValidCEP(strCEP: string) {\n\n    const objER = /^\\d{5}-\\d{3}$/;\n\n    if (strCEP.length > 0) {\n        if (objER.test(strCEP.replace(/(\\d{5})(\\d{3})/, \"$1-$2\")))\n            return true;\n        else\n            return false;\n    }\n    else\n        return false;\n}\n\nfunction isValidName(name: string) {\n    const pattern = /[A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ]{2,99}\\s[A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ]{2,99}/gi;\n    return pattern.test(name);\n\n}"]},"metadata":{},"sourceType":"module"}