{"ast":null,"code":"/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { createSlice } from '@reduxjs/toolkit';\nimport config from '../config';\nconst initialState = {\n  loginStatus: 'NOT_LOGGED',\n  userLogin: localStorage.getItem('login'),\n  token: localStorage.getItem('token')\n};\nconst userSlice = createSlice({\n  name: 'user',\n  initialState,\n  reducers: {\n    loginStart: (state, action) => {\n      state.loginStatus = 'LOGGING';\n      state.userLogin = '';\n    },\n    LoginSucess: (state, action) => {\n      state.loginStatus = 'LOGGED';\n      state.userLogin = action.payload.login;\n      state.token = action.payload.token;\n      localStorage.setItem('login', action.payload.login);\n      localStorage.setItem('token', action.payload.token);\n    },\n    incorrectLoginOrPassword: (state, action) => {\n      state.loginStatus = 'INCORRECT_LOGIN_OR_PASSWORD';\n      state.userLogin = '';\n    },\n    loginFailure: (state, action) => {\n      state.loginStatus = 'LOGIN_FAILURE';\n      state.userLogin = '';\n    },\n    logout: (state, action) => {\n      state.loginStatus = 'NOT_LOGGED';\n      state.token = '';\n    }\n  }\n});\nexport const {\n  loginStart,\n  LoginSucess,\n  incorrectLoginOrPassword,\n  loginFailure,\n  logout\n} = userSlice.actions;\nexport default userSlice.reducer;\nexport const loginThunk = (login, password) => {\n  return async (dispatch, getState) => {\n    const fetchUrl = config.apiUrl + '/login';\n    dispatch(loginStart({\n      login,\n      password,\n      url: fetchUrl\n    }));\n    const formData = new FormData();\n    formData.append('login', login);\n    formData.append('password', password);\n    await fetch(fetchUrl, {\n      method: 'post',\n      body: 'login=' + login + '&password=' + password + '',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n    }).then(body => body.json()).then(data => {\n      if ('auth' in data && data.auth === true) {\n        dispatch(LoginSucess({\n          login,\n          password,\n          token: data.token\n        }));\n      } else {\n        dispatch(incorrectLoginOrPassword({\n          login,\n          password\n        }));\n      }\n    }).catch(error => {\n      dispatch(loginFailure({\n        login,\n        password,\n        error\n      }));\n    });\n  };\n};","map":{"version":3,"sources":["/home/leo/Dev/Desafio_frontend_troupe_tecnologia/front/src/store/user.ts"],"names":["createSlice","config","initialState","loginStatus","userLogin","localStorage","getItem","token","userSlice","name","reducers","loginStart","state","action","LoginSucess","payload","login","setItem","incorrectLoginOrPassword","loginFailure","logout","actions","reducer","loginThunk","password","dispatch","getState","fetchUrl","apiUrl","url","formData","FormData","append","fetch","method","body","headers","then","json","data","auth","catch","error"],"mappings":"AAAA;AACA,SAA2BA,WAA3B,QAA6D,kBAA7D;AAGA,OAAOC,MAAP,MAAmB,WAAnB;AAiBA,MAAMC,YAAuB,GAAG;AAC5BC,EAAAA,WAAW,EAAE,YADe;AAE5BC,EAAAA,SAAS,EAAEC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAFiB;AAG5BC,EAAAA,KAAK,EAAEF,YAAY,CAACC,OAAb,CAAqB,OAArB;AAHqB,CAAhC;AAMA,MAAME,SAAS,GAAGR,WAAW,CAAC;AAC1BS,EAAAA,IAAI,EAAE,MADoB;AAE1BP,EAAAA,YAF0B;AAG1BQ,EAAAA,QAAQ,EAAE;AACNC,IAAAA,UAAU,EAAE,CAACC,KAAD,EAAmBC,MAAnB,KAAyD;AACjED,MAAAA,KAAK,CAACT,WAAN,GAAoB,SAApB;AACAS,MAAAA,KAAK,CAACR,SAAN,GAAkB,EAAlB;AAEH,KALK;AAMNU,IAAAA,WAAW,EAAE,CAACF,KAAD,EAAmBC,MAAnB,KAAyD;AAClED,MAAAA,KAAK,CAACT,WAAN,GAAoB,QAApB;AACAS,MAAAA,KAAK,CAACR,SAAN,GAAkBS,MAAM,CAACE,OAAP,CAAeC,KAAjC;AACAJ,MAAAA,KAAK,CAACL,KAAN,GAAcM,MAAM,CAACE,OAAP,CAAeR,KAA7B;AACAF,MAAAA,YAAY,CAACY,OAAb,CAAqB,OAArB,EAA8BJ,MAAM,CAACE,OAAP,CAAeC,KAA7C;AACAX,MAAAA,YAAY,CAACY,OAAb,CAAqB,OAArB,EAA8BJ,MAAM,CAACE,OAAP,CAAeR,KAA7C;AACH,KAZK;AAaNW,IAAAA,wBAAwB,EAAE,CAACN,KAAD,EAAQC,MAAR,KAA8C;AACpED,MAAAA,KAAK,CAACT,WAAN,GAAoB,6BAApB;AACAS,MAAAA,KAAK,CAACR,SAAN,GAAkB,EAAlB;AACH,KAhBK;AAiBNe,IAAAA,YAAY,EAAE,CAACP,KAAD,EAAQC,MAAR,KAA8C;AACxDD,MAAAA,KAAK,CAACT,WAAN,GAAoB,eAApB;AACAS,MAAAA,KAAK,CAACR,SAAN,GAAkB,EAAlB;AACH,KApBK;AAqBNgB,IAAAA,MAAM,EAAE,CAACR,KAAD,EAAQC,MAAR,KAA8C;AAClDD,MAAAA,KAAK,CAACT,WAAN,GAAoB,YAApB;AACAS,MAAAA,KAAK,CAACL,KAAN,GAAc,EAAd;AACH;AAxBK;AAHgB,CAAD,CAA7B;AA+BA,OAAO,MAAM;AAAEI,EAAAA,UAAF;AAAcG,EAAAA,WAAd;AAA2BI,EAAAA,wBAA3B;AAAqDC,EAAAA,YAArD;AAAmEC,EAAAA;AAAnE,IAA8EZ,SAAS,CAACa,OAA9F;AAEP,eAAeb,SAAS,CAACc,OAAzB;AAEA,OAAO,MAAMC,UAAU,GAAG,CAACP,KAAD,EAAgBQ,QAAhB,KAA+C;AAErE,SAAO,OAAOC,QAAP,EAA8BC,QAA9B,KAA4D;AAE/D,UAAMC,QAAQ,GAAG1B,MAAM,CAAC2B,MAAP,GAAc,QAA/B;AAEAH,IAAAA,QAAQ,CAACd,UAAU,CAAC;AAAEK,MAAAA,KAAF;AAASQ,MAAAA,QAAT;AAAmBK,MAAAA,GAAG,EAAEF;AAAxB,KAAD,CAAX,CAAR;AAOA,UAAMG,QAAQ,GAAG,IAAIC,QAAJ,EAAjB;AAEAD,IAAAA,QAAQ,CAACE,MAAT,CAAgB,OAAhB,EAAyBhB,KAAzB;AACAc,IAAAA,QAAQ,CAACE,MAAT,CAAgB,UAAhB,EAA4BR,QAA5B;AAEA,UAAMS,KAAK,CAACN,QAAD,EAAW;AAAGO,MAAAA,MAAM,EAAE,MAAX;AAAmBC,MAAAA,IAAI,EAAE,WAASnB,KAAT,GAAe,YAAf,GAA4BQ,QAA5B,GAAqC,EAA9D;AAAkEY,MAAAA,OAAO,EAAE;AAAE,wBAAgB;AAAlB;AAA3E,KAAX,CAAL,CACDC,IADC,CACIF,IAAI,IAAIA,IAAI,CAACG,IAAL,EADZ,EAEDD,IAFC,CAEKE,IAAD,IAA6B;AAE/B,UAAI,UAAUA,IAAV,IAAkBA,IAAI,CAACC,IAAL,KAAc,IAApC,EAA0C;AACtCf,QAAAA,QAAQ,CAACX,WAAW,CAAC;AAAEE,UAAAA,KAAF;AAASQ,UAAAA,QAAT;AAAmBjB,UAAAA,KAAK,EAAEgC,IAAI,CAAChC;AAA/B,SAAD,CAAZ,CAAR;AAEH,OAHD,MAGO;AACHkB,QAAAA,QAAQ,CAACP,wBAAwB,CAAC;AAAEF,UAAAA,KAAF;AAASQ,UAAAA;AAAT,SAAD,CAAzB,CAAR;AACH;AACJ,KAVC,EAWDiB,KAXC,CAWKC,KAAK,IAAI;AACZjB,MAAAA,QAAQ,CAACN,YAAY,CAAC;AAAEH,QAAAA,KAAF;AAASQ,QAAAA,QAAT;AAAmBkB,QAAAA;AAAnB,OAAD,CAAb,CAAR;AACH,KAbC,CAAN;AAcH,GA9BD;AA+BH,CAjCM","sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { createAsyncThunk, createSlice, PayloadAction } from '@reduxjs/toolkit'\nimport { Action } from \"redux\";\nimport { AppDispatch, AppThunk, RootState } from '.';\nimport config from '../config';\n\n\nexport interface UserState {\n    loginStatus: 'NOT_LOGGED' | 'LOGGING' | 'LOGGED' | 'LOGIN_FAILURE' | 'INCORRECT_LOGIN_OR_PASSWORD',\n    userLogin: string,\n    token: string\n}\n\nexport interface UserAction {\n    login: string,\n    password: string,\n    error?: any,\n    token?: string,\n    url?: string,\n}\n\nconst initialState: UserState = {\n    loginStatus: 'NOT_LOGGED',\n    userLogin: localStorage.getItem('login'),\n    token: localStorage.getItem('token')\n}\n\nconst userSlice = createSlice({\n    name: 'user',\n    initialState,\n    reducers: {\n        loginStart: (state: UserState, action: PayloadAction<UserAction>) => {\n            state.loginStatus = 'LOGGING';\n            state.userLogin = '';\n\n        },\n        LoginSucess: (state: UserState, action: PayloadAction<UserAction>) => {\n            state.loginStatus = 'LOGGED';\n            state.userLogin = action.payload.login;\n            state.token = action.payload.token;\n            localStorage.setItem('login', action.payload.login);\n            localStorage.setItem('token', action.payload.token);\n        },\n        incorrectLoginOrPassword: (state, action: PayloadAction<UserAction>) => {\n            state.loginStatus = 'INCORRECT_LOGIN_OR_PASSWORD';\n            state.userLogin = '';\n        },\n        loginFailure: (state, action: PayloadAction<UserAction>) => {\n            state.loginStatus = 'LOGIN_FAILURE';\n            state.userLogin = '';\n        },\n        logout: (state, action: PayloadAction<UserAction>) => {\n            state.loginStatus = 'NOT_LOGGED';\n            state.token = '';\n        }\n    }\n})\n\nexport const { loginStart, LoginSucess, incorrectLoginOrPassword, loginFailure, logout } = userSlice.actions\n\nexport default userSlice.reducer;\n\nexport const loginThunk = (login: string, password: string): AppThunk => {\n  \n    return async (dispatch: AppDispatch, getState: () => RootState) => {\n\n        const fetchUrl = config.apiUrl+'/login';\n\n        dispatch(loginStart({ login, password, url: fetchUrl }));\n\n        interface LoginResponseType {\n            auth: boolean,\n            token?: string,\n        }\n\n        const formData = new FormData();\n\n        formData.append('login', login);\n        formData.append('password', password);\n\n        await fetch(fetchUrl, {  method: 'post', body: 'login='+login+'&password='+password+'', headers: { 'Content-Type': 'application/x-www-form-urlencoded'}})\n            .then(body => body.json())\n            .then((data: LoginResponseType) => {\n\n                if ('auth' in data && data.auth === true) {\n                    dispatch(LoginSucess({ login, password, token: data.token }));\n\n                } else {\n                    dispatch(incorrectLoginOrPassword({ login, password }));\n                }\n            })\n            .catch(error => {\n                dispatch(loginFailure({ login, password, error }));\n            })        \n    }\n}"]},"metadata":{},"sourceType":"module"}